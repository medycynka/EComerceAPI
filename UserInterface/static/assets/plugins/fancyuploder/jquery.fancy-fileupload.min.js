!function($){var a=function(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return a.replace(/[&<>"']/g,function(a){return b[a]})},b=function(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(c,a){return void 0!==b[a]?b[a]:c})},c=function(a,f,b){if(0==a)return"0 Bytes";if(1==a)return"1 Byte";a=Math.abs(a),b&&"iec_formal"===b.toLowerCase()?(e=1024,g=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]):b&&"si"===b.toLowerCase()?(e=1e3,g=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"]):(e=1024,g=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"]);var e,g,c=Math.floor(Math.log(a)/Math.log(e)),d=a/Math.pow(e,c);return(0==c||f&&d>=99.995?d.toFixed(0):d.toFixed(2))+" "+g[c]},d=function(a,e){var b=$('<div class="ff_fileupload_dialog_background"></div>'),c=a.clone(!0,!0).click(function(a){a.stopPropagation()}),d=$('<div class="ff_fileupload_dialog_main"></div>').append(c),f=function(){$(document).off("keyup.fancy_fileupload"),b.remove(),e.focus()};$(document).on("keyup.fancy_fileupload",function(a){27==a.keyCode&&f()}),b.append(d).click(function(){f()}),$("body").append(b),a.focus()},e=function(a){a.find("button").hover(function(){var b=$(this).attr("aria-label");b&&(a.find(".ff_fileupload_buttoninfo").text(b).removeClass("ff_fileupload_hidden"),a.find(".ff_fileupload_fileinfo").addClass("ff_fileupload_hidden"))},function(){a.find(".ff_fileupload_fileinfo").removeClass("ff_fileupload_hidden"),a.find(".ff_fileupload_buttoninfo").addClass("ff_fileupload_hidden")})};$.fn.FancyFileUpload=function(f){if(this.each(function(){var a=$(this);if(a.data("fancy-fileupload")&&"object"==typeof a.data("fancy-fileupload")){a.removeClass("ff_fileupload_hidden");var b=a.data("fancy-fileupload");b.form.find("input[type=file]").fileupload("destroy"),b.form.remove(),b.fileuploadwrap.remove()}}),$(".ff_fileupload_hidden").length||$(document).off("drop.fancy_fileupload dragover.fancy_fileupload"),"string"==typeof f&&"destroy"===f)return this;var g=$.extend({},$.fn.FancyFileUpload.defaults,f),h=function(a){return g.langmap[a]?g.langmap[a]:a},i=0;$(window).on("beforeunload",function(a){if(i>0)return h("There is a file upload still in progress.  Leaving the page will cancel the upload.\n\nAre you sure you want to leave this page?")});var j=document.createElement("audio"),k=document.createElement("video"),l=function(w,x,a){var r,f=$('<tr><td class="ff_fileupload_preview"><button class="ff_fileupload_preview_image" type="button"><span class="ff_fileupload_preview_text"></span></button><div class="ff_fileupload_actions_mobile"></div></td><td class="ff_fileupload_summary"><div class="ff_fileupload_filename"></div><div class="ff_fileupload_fileinfo"></div><div class="ff_fileupload_buttoninfo ff_fileupload_hidden"></div><div class="ff_fileupload_errors ff_fileupload_hidden"></div><div class="ff_fileupload_progress_background ff_fileupload_hidden"><div class="ff_fileupload_progress_bar"></div></div></td><td class="ff_fileupload_actions"></td></tr>'),l=a.files[0].name.lastIndexOf("."),y=l> -1?a.files[0].name.substring(0,l):a.files[0].name,m=l> -1?a.files[0].name.substring(l+1).toLowerCase():"",s="abcdefghijklmnopqrstuvwxyz0123456789";l=""==m?-1:s.indexOf(m.charAt(0));var z=s.charAt(l> -1?l:Math.floor(Math.random()*s.length));a.ff_info={},a.ff_info.errors=[],a.ff_info.retries=0,a.ff_info.retrydelay=g.retrydelay,a.ff_info.uploading=!1,a.ff_info.removewidget=!1,a.ff_info.inforow=f,a.ff_info.displayfilesize=c(a.files[0].size,g.adjustprecision,g.displayunits),a.context=f;var u=function(c){if(c.preventDefault(),g.edit&&!a.ff_info.errors.length){var d=f.find(".ff_fileupload_filename input");if(d.length){var b=d.val();""!=m&&(b+="."+m),f.find(".ff_fileupload_filename").text(b),a.files[0].uploadName=b}}f.find("button.ff_fileupload_start_upload").remove(),f.find(".ff_fileupload_fileinfo").removeClass("ff_fileupload_hidden"),f.find(".ff_fileupload_buttoninfo").addClass("ff_fileupload_hidden"),f.find(".ff_fileupload_fileinfo").text(a.ff_info.displayfilesize+" | "+h("Starting upload...")),f.find(".ff_fileupload_progress_background").removeClass("ff_fileupload_hidden"),f.find("button.ff_fileupload_remove_file").attr("aria-label",h("Cancel upload and remove from list"));var e=function(){i++,a.ff_info.uploading=!0,a.submit()};g.startupload?g.startupload.call(f,e,c,a):e()},v=function(b){(b.preventDefault(),void 0!==g.fileRemoveOption&&g.fileRemoveOption(a.files[0].name),a.ff_info.uploading)?!confirm(h("This file is currently being uploaded.\n\nStop the upload and remove the file from the list?"))||(a.ff_info.removewidget=!0,a.abort()):(f.remove(),delete a.ff_info)};a.ff_info.RemoveFile=function(){a.ff_info.uploading?(a.ff_info.removewidget=!0,a.abort()):(f.remove(),delete a.ff_info)};var o=!1,t=!1;if(URL&&URL.createObjectURL){var n=URL.createObjectURL(a.files[0]);n&&("image/gif"===a.files[0].type||"image/jpeg"===a.files[0].type||"image/png"===a.files[0].type?(f.find(".ff_fileupload_preview_image").css("background-image",'url("'+n+'")'),o=!0,r=$("<img>").attr("src",n),t=!0):a.files[0].type.lastIndexOf("audio/",0)> -1&&j.canPlayType&&j.canPlayType(a.files[0].type)?(o=!0,r=$("<audio>").attr("src",n).prop("controls",!0)):a.files[0].type.lastIndexOf("video/",0)> -1&&k.canPlayType&&k.canPlayType(a.files[0].type)&&(o=!0,r=$("<video>").attr("src",n).prop("controls",!0)))}if(o?f.find(".ff_fileupload_preview_image").addClass("ff_fileupload_preview_image_has_preview").attr("aria-label",h("Preview")).click(function(a){a.preventDefault(),this.blur(),d(r,this)}):f.find(".ff_fileupload_preview_image").prop("disabled",!0).attr("aria-label",h("No preview available")).click(function(a){a.preventDefault()}),t||f.find(".ff_fileupload_preview_image").addClass("ff_fileupload_preview_text_with_color").addClass("ff_fileupload_preview_text_"+z).text(m),g.accept){var p=!1;if(g.accept.length>0&&"*"!==g.accept[0])for(var q=0;q<g.accept.length&&!p;q++)(g.accept[q]===m||g.accept[q]===a.files[0].type)&&(p=!0);else p=!0;p||a.ff_info.errors.push(h("Invalid file extension.")+h("Accepted extensions: ")+g.accept.join(", "))}g.maxfilesize> -1&&a.files[0].size>g.maxfilesize&&a.ff_info.errors.push(b(h("File is too large.  Maximum file size is {0}."),c(g.maxfilesize,g.adjustprecision,g.displayunits))),g.edit&&!a.ff_info.errors.length?f.find(".ff_fileupload_filename").append($('<input style="border: 1px solid #eaedf1; border-radius: 5px; padding: 7px; max-width: 50%;">').attr("type","text").val(y).keydown(function(a){13==a.keyCode&&(void 0===g.allowUpload&& !0===g.allowUpload?u(a):a.preventDefault())})):f.find(".ff_fileupload_filename").text(a.files[0].name),f.find(".ff_fileupload_fileinfo").text(a.ff_info.displayfilesize+(t&&g.edit&&!a.ff_info.errors.length?" | ."+m:"")),a.ff_info.errors.length&&f.find(".ff_fileupload_errors").html(a.ff_info.errors.join("<br>")).removeClass("ff_fileupload_hidden"),a.ff_info.errors.length||(f.find(".ff_fileupload_actions").append($("<button>").addClass("ff_fileupload_start_upload").attr("type","button").attr("aria-label",h("Start uploading")).click(u)),f.find(".ff_fileupload_actions_mobile").append($("<button>").addClass("ff_fileupload_start_upload").attr("type","button").attr("aria-label",h("Start uploading")).click(u))),f.find(".ff_fileupload_actions").append($("<button>").addClass("ff_fileupload_remove_file").attr("type","button").attr("aria-label",h("Remove from list")).click(v)),f.find(".ff_fileupload_actions_mobile").append($("<button>").addClass("ff_fileupload_remove_file").attr("type","button").attr("aria-label",h("Remove from list")).click(v)),e(f),a.ff_info.fileinfo=f.find(".ff_fileupload_fileinfo"),a.ff_info.progressbar=f.find(".ff_fileupload_progress_bar"),w.append(f),g.added&&g.added.call(f,x,a)},m=function(e,a){var d=a.total<1?0:a.loaded/a.total*100;a.ff_info.fileinfo.text(b(h("{0} of {1} | {2}%"),c(a.loaded,g.adjustprecision,g.displayunits),a.ff_info.displayfilesize,d.toFixed(0))),a.ff_info.progressbar.css("width",d+"%"),g.continueupload&& !1===g.continueupload.call(a.ff_info.inforow,e,a)&&a.abort()},n=function(d,c){if("abort"!==c.errorThrown&&"failed_with_msg"!==c.errorThrown&&c.uploadedBytes<c.files[0].size&&c.ff_info.retries<g.retries){c.ff_info.fileinfo.text(b(h("{0} | Network error, retrying in a moment..."),c.ff_info.displayfilesize)),setTimeout(function(){c.data=null,c.submit()},c.ff_info.retrydelay),c.ff_info.retries++,c.ff_info.retrydelay*=2;return}i--,c.ff_info.uploading=!1,g.uploadcancelled&&g.uploadcancelled.call(c.ff_info.inforow,d,c),c.ff_info.removewidget?(c.ff_info.inforow.remove(),delete c.ff_info):("abort"===c.errorThrown?c.ff_info.errors.push(h("The upload was cancelled.")):"failed_with_msg"===c.errorThrown?c.ff_info.errors.push(b(h("The upload failed.  {0} ({1})"),a(c.result.error),a(c.result.errorcode))):c.ff_info.errors.push(h("The upload failed.")),c.ff_info.inforow.find(".ff_fileupload_errors").html(c.ff_info.errors.join("<br>")).removeClass("ff_fileupload_hidden"),c.ff_info.inforow.find(".ff_fileupload_progress_background").addClass("ff_fileupload_hidden"),c.ff_info.inforow.find("button.ff_fileupload_remove_file").attr("aria-label",h("Remove from list")))},o=function(b,a){if(!a.result.success){"string"!=typeof a.result.error&&(a.result.error=h("The server indicated that the upload was not successful.  No additional information available.")),"string"!=typeof a.result.errorcode&&(a.result.errorcode=h("server_response")),a.errorThrown="failed_with_msg",a.ff_info.removewidget=!1,n(b,a);return}i--,a.ff_info.uploading=!1,g.uploadcompleted&&g.uploadcompleted.call(a.ff_info.inforow,b,a),a.ff_info.removewidget?(a.ff_info.inforow.remove(),delete a.ff_info):(a.ff_info.inforow.find(".ff_fileupload_fileinfo").text(a.ff_info.displayfilesize+" | "+h("Upload completed")),a.ff_info.inforow.find(".ff_fileupload_progress_background").addClass("ff_fileupload_hidden"),a.ff_info.inforow.find("button.ff_fileupload_remove_file").attr("aria-label",h("Remove from list")))},p=function(b,a){a.ff_info.retries=0,a.ff_info.retrydelay=g.retrydelay,a.result.success||a.abort()};return this.each(function(){var a=$(this);if(""===g.url){var i=a.closest("form").attr("action");i&&(g.url=i)}var e=$("<form>").addClass("ff_fileupload_hidden").attr({action:g.url,method:"post",enctype:"multipart/form-data"});for(var b in $("body").append(e),g.params)if(g.params.hasOwnProperty(b)){var r=$("<input>").attr({type:"hidden",name:b,value:g.params[b]});e.append(r)}var s=a.attr("name"),c=$("<input>").attr({type:"file",name:s||"file"});if(a.prop("multiple")&&c.prop("multiple",!0),a.attr("accept")&&(c.attr("accept",a.attr("accept")),!g.accept)){var q=a.attr("accept").split(",");g.accept=[];for(var b=0;b<q.length;b++){var d=$.trim(q[b]).toLowerCase();g.accept.push(0>d.indexOf("/")&&d.lastIndexOf(".")> -1?d.substring(d.lastIndexOf(".")+1):d)}}c.on("click",function(a){console.log("INPUT CLICK",a)}),c.on("CHANGE",function(a){console.log("INPUT CHANGE",a)}),e.append(c);var f=$("<div>").addClass("ff_fileupload_wrap");a.after(f);var j=$("<div>").addClass("ff_fileupload_dropzone_wrap"),k=$("<button>").addClass("ff_fileupload_dropzone").attr("type","button").attr("aria-label",h("Browse, drag-and-drop, or paste files to upload"));j.append(k),f.append(j),k.on("click.fancy_fileupload",function(a){a.preventDefault(),e.find("input[type=file]").click()});var t=$("<table>").addClass("ff_fileupload_uploads");f.append(t),a.addClass("ff_fileupload_hidden");var u={url:i,dataType:"json",pasteZone:j,limitConcurrentUploads:2},v={singleFileUploads:!0,dropZone:k,add:function(a,b){l(t,a,b)},progress:m,fail:n,done:o,chunkdone:p};c.fileupload($.extend(u,g.fileupload,v)),void 0!==g.initialInput&&null!==g.initialInput&&(console.log(g.initialInput),c.fileupload("add",{files:g.initialInput[0].files})),a.data("fancy-fileupload",{fileuploadwrap:f,form:e})})},$.fn.FancyFileUpload.defaults={url:"",params:{},edit:!0,maxfilesize:-1,accept:null,displayunits:"iec_windows",adjustprecision:!0,retries:5,retrydelay:500,added:null,startupload:null,continueupload:null,uploadcancelled:null,uploadcompleted:null,fileupload:{},langmap:{},initialInput:null}}(jQuery)