!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],a):"object"==typeof exports?a(require("jquery"),require("./vendor/jquery.ui.widget")):a(window.jQuery)}(function($){"use strict";function a(a){var b="dragover"===a;return function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var d=c.dataTransfer;d&& -1!==$.inArray("Files",d.types)&& !1!==this._trigger(a,$.Event(a,{delegatedEvent:c}))&&(c.preventDefault(),b&&(d.dropEffect="copy"))}}$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$('<input type="file">').prop("disabled")),$.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader),$.support.xhrFormDataFileUpload=!!window.FormData,$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(a,b){return a=this.messages[a]||a.toString(),b&&$.each(b,function(b,c){a=a.replace("{"+b+"}",c)}),a},formData:function(a){return a.serializeArray()},add:function(b,a){if(b.isDefaultPrevented())return!1;(a.autoUpload|| !1!==a.autoUpload&&$(this).fileupload("option","autoUpload"))&&a.process().done(function(){a.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():new Date().getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(a,b,c){var d=a-this.timestamp;return this.bitrate&&c&&!(d>c)||(this.bitrate=(b-this.loaded)*(1e3/d)*8,this.loaded=b,this.timestamp=a),this.bitrate}},_isXHRUpload:function(a){return!a.forceIframeTransport&&(!a.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(a){var b;return"function"===$.type(a.formData)?a.formData(a.form):$.isArray(a.formData)?a.formData:"object"===$.type(a.formData)?(b=[],$.each(a.formData,function(a,c){b.push({name:a,value:c})}),b):[]},_getTotal:function(a){var b=0;return $.each(a,function(c,a){b+=a.size||1}),b},_initProgressObject:function(a){var b={loaded:0,total:0,bitrate:0};a._progress?$.extend(a._progress,b):a._progress=b},_initResponseObject:function(a){var b;if(a._response)for(b in a._response)a._response.hasOwnProperty(b)&&delete a._response[b];else a._response={}},_onProgress:function(b,a){if(b.lengthComputable){var c,d=Date.now?Date.now():new Date().getTime();a._time&&a.progressInterval&&d-a._time<a.progressInterval&&b.loaded!==b.total||(a._time=d,c=Math.floor(b.loaded/b.total*(a.chunkSize||a._progress.total))+(a.uploadedBytes||0),this._progress.loaded+=c-a._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(d,this._progress.loaded,a.bitrateInterval),a._progress.loaded=a.loaded=c,a._progress.bitrate=a.bitrate=a._bitrateTimer.getBitrate(d,c,a.bitrateInterval),this._trigger("progress",$.Event("progress",{delegatedEvent:b}),a),this._trigger("progressall",$.Event("progressall",{delegatedEvent:b}),this._progress))}},_initProgressListener:function(a){var c=this,b=a.xhr?a.xhr():$.ajaxSettings.xhr();b.upload&&($(b.upload).bind("progress",function(b){var d=b.originalEvent;b.lengthComputable=d.lengthComputable,b.loaded=d.loaded,b.total=d.total,c._onProgress(b,a)}),a.xhr=function(){return b})},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},_initXHRData:function(a){var b,f=this,c=a.files[0],d=a.multipart||!$.support.xhrFileUpload,e="array"===$.type(a.paramName)?a.paramName[0]:a.paramName;a.headers=$.extend({},a.headers),a.contentRange&&(a.headers["Content-Range"]=a.contentRange),d&&!a.blob&&this._isInstanceOf("File",c)||(a.headers["Content-Disposition"]='attachment; filename="'+encodeURI(c.name)+'"'),d?$.support.xhrFormDataFileUpload&&(a.postMessage?(b=this._getFormData(a),a.blob?b.push({name:e,value:a.blob}):$.each(a.files,function(c,d){b.push({name:"array"===$.type(a.paramName)&&a.paramName[c]||e,value:d})})):(f._isInstanceOf("FormData",a.formData)?b=a.formData:(b=new FormData,$.each(this._getFormData(a),function(c,a){b.append(a.name,a.value)})),a.blob?b.append(e,a.blob,c.name):$.each(a.files,function(d,c){(f._isInstanceOf("File",c)||f._isInstanceOf("Blob",c))&&b.append("array"===$.type(a.paramName)&&a.paramName[d]||e,c,c.uploadName||c.name)})),a.data=b):(a.contentType=c.type||"application/octet-stream",a.data=a.blob||c),a.blob=null},_initIframeSettings:function(a){var b=$("<a></a>").prop("href",a.url).prop("host");a.dataType="iframe "+(a.dataType||""),a.formData=this._getFormData(a),a.redirect&&b&&b!==location.host&&a.formData.push({name:a.redirectParamName||"redirect",value:a.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(b){var c=$(b.fileInput),a=b.paramName;return a?$.isArray(a)||(a=[a]):(a=[],c.each(function(){for(var b=$(this),d=b.prop("name")||"files[]",c=(b.prop("files")||[1]).length;c;)a.push(d),c-=1}),a.length||(a=[c.prop("name")||"files[]"])),a},_initFormSettings:function(a){a.form&&a.form.length||(a.form=$(a.fileInput.prop("form")),a.form.length||(a.form=$(this.options.fileInput.prop("form")))),a.paramName=this._getParamName(a),a.url||(a.url=a.form.prop("action")||location.href),a.type=(a.type||"string"===$.type(a.form.prop("method"))&&a.form.prop("method")||"").toUpperCase(),"POST"!==a.type&&"PUT"!==a.type&&"PATCH"!==a.type&&(a.type="POST"),a.formAcceptCharset||(a.formAcceptCharset=a.form.attr("accept-charset"))},_getAJAXSettings:function(b){var a=$.extend({},this.options,b);return this._initFormSettings(a),this._initDataSettings(a),a},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(d,a,e){var b=$.Deferred(),c=b.promise();return a=a||this.options.context||c,!0===d?b.resolveWith(a,e):!1===d&&b.rejectWith(a,e),c.abort=b.promise,this._enhancePromise(c)},_addConvenienceMethods:function(b,a){var c=this,d=function(a){return $.Deferred().resolveWith(c,a).promise()};a.process=function(b,e){return(b||e)&&(a._processQueue=this._processQueue=(this._processQueue||d([this])).then(function(){return a.errorThrown?$.Deferred().rejectWith(c,[a]).promise():d(arguments)}).then(b,e)),this._processQueue||d([this])},a.submit=function(){return"pending"!==this.state()&&(a.jqXHR=this.jqXHR=!1!==c._trigger("submit",$.Event("submit",{delegatedEvent:b}),this)&&c._onSend(b,this)),this.jqXHR||c._getXHRPromise()},a.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",c._trigger("fail",null,this),c._getXHRPromise(!1))},a.state=function(){return this.jqXHR?c._getDeferredState(this.jqXHR):this._processQueue?c._getDeferredState(this._processQueue):void 0},a.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===c._getDeferredState(this._processQueue)},a.progress=function(){return this._progress},a.response=function(){return this._response}},_getUploadedBytes:function(d){var b=d.getResponseHeader("Range"),a=b&&b.split("-"),c=a&&a.length>1&&parseInt(a[1],10);return c&&c+1},_chunkedUpload:function(a,h){a.uploadedBytes=a.uploadedBytes||0;var k,f,l=this,b=a.files[0],c=b.size,g=a.uploadedBytes,d=a.maxChunkSize||c,i=this._blobSlice,j=$.Deferred(),e=j.promise();return!!(this._isXHRUpload(a)&&i&&(g||("function"===$.type(d)?d(a):d)<c))&&!a.data&&(!!h||(g>=c?(b.error=a.i18n("uploadedBytes"),this._getXHRPromise(!1,a.context,[null,"error",b.error])):(f=function(){var e=$.extend({},a),h=e._progress.loaded;e.blob=i.call(b,g,g+("function"===$.type(d)?d(e):d),b.type),e.chunkSize=e.blob.size,e.contentRange="bytes "+g+"-"+(g+e.chunkSize-1)+"/"+c,l._initXHRData(e),l._initProgressListener(e),k=(!1!==l._trigger("chunksend",null,e)&&$.ajax(e)||l._getXHRPromise(!1,e.context)).done(function(d,i,b){g=l._getUploadedBytes(b)||g+e.chunkSize,h+e.chunkSize-e._progress.loaded&&l._onProgress($.Event("progress",{lengthComputable:!0,loaded:g-e.uploadedBytes,total:g-e.uploadedBytes}),e),a.uploadedBytes=e.uploadedBytes=g,e.result=d,e.textStatus=i,e.jqXHR=b,l._trigger("chunkdone",null,e),l._trigger("chunkalways",null,e),g<c?f():j.resolveWith(e.context,[d,i,b])}).fail(function(a,b,c){e.jqXHR=a,e.textStatus=b,e.errorThrown=c,l._trigger("chunkfail",null,e),l._trigger("chunkalways",null,e),j.rejectWith(e.context,[a,b,c])})},this._enhancePromise(e),e.abort=function(){return k.abort()},f(),e)))},_beforeSend:function(b,a){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(a),this._initProgressObject(a),a._progress.loaded=a.loaded=a.uploadedBytes||0,a._progress.total=a.total=this._getTotal(a.files)||1,a._progress.bitrate=a.bitrate=0,this._active+=1,this._progress.loaded+=a.loaded,this._progress.total+=a.total},_onDone:function(d,e,f,a){var b=a._progress.total,c=a._response;a._progress.loaded<b&&this._onProgress($.Event("progress",{lengthComputable:!0,loaded:b,total:b}),a),c.result=a.result=d,c.textStatus=a.textStatus=e,c.jqXHR=a.jqXHR=f,this._trigger("done",null,a)},_onFail:function(c,d,e,a){var b=a._response;a.recalculateProgress&&(this._progress.loaded-=a._progress.loaded,this._progress.total-=a._progress.total),b.jqXHR=a.jqXHR=c,b.textStatus=a.textStatus=d,b.errorThrown=a.errorThrown=e,this._trigger("fail",null,a)},_onAlways:function(b,c,d,a){this._trigger("always",null,a)},_onSend:function(e,c){c.submit||this._addConvenienceMethods(e,c);var h,i,d,a,f=this,g=f._getAJAXSettings(c),b=function(){return f._sending+=1,g._bitrateTimer=new f._BitrateTimer,h=h||((i|| !1===f._trigger("send",$.Event("send",{delegatedEvent:e}),g))&&f._getXHRPromise(!1,g.context,i)||f._chunkedUpload(g)||$.ajax(g)).done(function(a,b,c){f._onDone(a,b,c,g)}).fail(function(a,b,c){f._onFail(a,b,c,g)}).always(function(b,c,d){if(f._onAlways(b,c,d,g),f._sending-=1,f._active-=1,g.limitConcurrentUploads&&g.limitConcurrentUploads>f._sending)for(var a=f._slots.shift();a;){if("pending"===f._getDeferredState(a)){a.resolve();break}a=f._slots.shift()}0===f._active&&f._trigger("stop")})};return(this._beforeSend(e,g),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)?(this.options.limitConcurrentUploads>1?(d=$.Deferred(),this._slots.push(d),a=d.then(b)):(this._sequence=this._sequence.then(b,b),a=this._sequence),a.abort=function(){return(i=[void 0,"abort","abort"],h)?h.abort():(d&&d.rejectWith(g.context,i),b())},this._enhancePromise(a)):b()},_onAdd:function(p,l){var e,f,g,a,q=this,o=!0,c=$.extend({},this.options,l),b=l.files,j=b.length,d=c.limitMultiFileUploads,h=c.limitMultiFileUploadSize,n=c.limitMultiFileUploadSizeOverhead,m=0,i=this._getParamName(c),k=0;if(!j)return!1;if(h&& void 0===b[0].size&&(h=void 0),(c.singleFileUploads||d||h)&&this._isXHRUpload(c)){if(!(c.singleFileUploads||h)&&d)for(a=0,g=[],e=[];a<j;a+=d)g.push(b.slice(a,a+d)),(f=i.slice(a,a+d)).length||(f=i),e.push(f);else if(!c.singleFileUploads&&h)for(a=0,g=[],e=[];a<j;a+=1)m+=b[a].size+n,(a+1===j||m+b[a+1].size+n>h||d&&a+1-k>=d)&&(g.push(b.slice(k,a+1)),(f=i.slice(k,a+1)).length||(f=i),e.push(f),k=a+1,m=0);else e=i}else g=[b],e=[i];return l.originalFiles=b,$.each(g||b,function(c,b){var a=$.extend({},l);return a.files=g?b:[b],a.paramName=e[c],q._initResponseObject(a),q._initProgressObject(a),q._addConvenienceMethods(p,a),o=q._trigger("add",$.Event("add",{delegatedEvent:p}),a)}),o},_replaceFileInput:function(c){var a=c.fileInput,b=a.clone(!0),d=a.is(document.activeElement);c.fileInputClone=b,$("<form></form>").append(b)[0].reset(),a.after(b).detach(),d&&b.focus(),$.cleanData(a.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(d,c){return c===a[0]?b[0]:c}),a[0]===this.element[0]&&(this.element=b)},_handleFileTreeEntry:function(a,b){var d,g=this,c=$.Deferred(),h=[],e=function(b){b&&!b.entry&&(b.entry=a),c.resolve([b])},i=function(d){g._handleFileTreeEntries(d,b+a.name+"/").done(function(a){c.resolve(a)}).fail(e)},f=function(){d.readEntries(function(a){a.length?(h=h.concat(a),f()):i(h)},e)};return b=b||"",a.isFile?a._file?(a._file.relativePath=b,c.resolve(a._file)):a.file(function(a){a.relativePath=b,c.resolve(a)},e):a.isDirectory?(d=a.createReader(),f()):c.resolve([]),c.promise()},_handleFileTreeEntries:function(a,b){var c=this;return $.when.apply($,$.map(a,function(a){return c._handleFileTreeEntry(a,b)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(b){var a=(b=b||{}).items;return a&&a.length&&(a[0].webkitGetAsEntry||a[0].getAsEntry)?this._handleFileTreeEntries($.map(a,function(a){var b;return a.webkitGetAsEntry?((b=a.webkitGetAsEntry())&&(b._file=a.getAsFile()),b):a.getAsEntry()})):$.Deferred().resolve($.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){var a,d,c=(b=$(b)).prop("webkitEntries")||b.prop("entries");if(c&&c.length)return this._handleFileTreeEntries(c);if((a=$.makeArray(b.prop("files"))).length)void 0===a[0].name&&a[0].fileName&&$.each(a,function(b,a){a.name=a.fileName,a.size=a.fileSize});else{if(!(d=b.prop("value")))return $.Deferred().resolve([]).promise();a=[{name:d.replace(/^.*\\/,"")}]}return $.Deferred().resolve(a).promise()},_getFileInputFiles:function(a){return a instanceof $&&1!==a.length?$.when.apply($,$.map(a,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(a)},_onChange:function(a){var c=this,b={fileInput:$(a.target),form:$(a.target.form)};this._getFileInputFiles(b.fileInput).always(function(d){b.files=d,c.options.replaceFileInput&&c._replaceFileInput(b),!1!==c._trigger("change",$.Event("change",{delegatedEvent:a}),b)&&c._onAdd(a,b)})},_onPaste:function(a){var b=a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.items,c={files:[]};b&&b.length&&($.each(b,function(d,a){var b=a.getAsFile&&a.getAsFile();b&&c.files.push(b)}),!1!==this._trigger("paste",$.Event("paste",{delegatedEvent:a}),c)&&this._onAdd(a,c))},_onDrop:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var c=this,b=a.dataTransfer,d={};b&&b.files&&b.files.length&&(a.preventDefault(),this._getDroppedFiles(b).always(function(b){d.files=b,!1!==c._trigger("drop",$.Event("drop",{delegatedEvent:a}),d)&&c._onAdd(a,d)}))},_onDragOver:a("dragover"),_onDragEnter:a("dragenter"),_onDragLeave:a("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),$.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(a,c){var b=-1!==$.inArray(a,this._specialOptions);b&&this._destroyEventHandlers(),this._super(a,c),b&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var a=this.options;void 0===a.fileInput?a.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):a.fileInput instanceof $||(a.fileInput=$(a.fileInput)),a.dropZone instanceof $||(a.dropZone=$(a.dropZone)),a.pasteZone instanceof $||(a.pasteZone=$(a.pasteZone))},_getRegExp:function(b){var a=b.split("/"),c=a.pop();return a.shift(),new RegExp(a.join("/"),c)},_isRegExpOption:function(b,a){return"url"!==b&&"string"===$.type(a)&&/^\/.*\/[igm]{0,3}$/.test(a)},_initDataAttributes:function(){var a=this,b=this.options,c=this.element.data();$.each(this.element[0].attributes,function(g,f){var d,e=f.name.toLowerCase();/^data-/.test(e)&&(d=c[e=e.slice(5).replace(/-[a-z]/g,function(a){return a.charAt(1).toUpperCase()})],a._isRegExpOption(e,d)&&(d=a._getRegExp(d)),b[e]=d)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(a){var b=this;a&&!this.options.disabled&&(a.fileInput&&!a.files?this._getFileInputFiles(a.fileInput).always(function(c){a.files=c,b._onAdd(null,a)}):(a.files=$.makeArray(a.files),this._onAdd(null,a)))},send:function(a){if(a&&!this.options.disabled){if(a.fileInput&&!a.files){var d,e,f=this,c=$.Deferred(),b=c.promise();return b.abort=function(){return(e=!0,d)?d.abort():(c.reject(null,"abort","abort"),b)},this._getFileInputFiles(a.fileInput).always(function(b){if(!e){if(!b.length){c.reject();return}a.files=b,(d=f._onSend(null,a)).then(function(a,b,d){c.resolve(a,b,d)},function(a,b,d){c.reject(a,b,d)})}}),this._enhancePromise(b)}if(a.files=$.makeArray(a.files),a.files.length)return this._onSend(null,a)}return this._getXHRPromise(!1,a&&a.context)}})})