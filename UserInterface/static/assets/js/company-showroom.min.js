const globalLoader=$("#global-loader"),dataTableLanguageOpt={sProcessing:"Przetwarzanie...",sLengthMenu:"Pokaż _MENU_ pozycji",sZeroRecords:"Nie znaleziono pasujących pozycji",sInfoThousands:" ",sInfo:"Pozycje od _START_ do _END_ z _TOTAL_ łącznie",sInfoEmpty:"Pozycji 0 z 0 dostępnych",sInfoFiltered:"(filtrowanie spośr\xf3d _MAX_ dostępnych pozycji)",sInfoPostFix:"",sSearch:"Szukaj:",sUrl:"",oPaginate:{sFirst:"Pierwsza",sPrevious:"Poprzednia",sNext:"Następna",sLast:"Ostatnia"},sEmptyTable:"Brak danych",sLoadingRecords:"Wczytywanie...",oAria:{sSortAscending:": aktywuj, by posortować kolumnę rosnąco",sSortDescending:": aktywuj, by posortować kolumnę malejąco"}},changesInTabs={tab2:{newRows:new Set,editedRows:new Set,removedRows:new Set},tab3:{newRows:new Set,editedRows:new Set,removedRows:new Set},tab4:{newRows:new Set,editedRows:new Set,removedRows:new Set}},fileMimeTypes={abs:"audio/x-mpeg",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",aim:"application/x-aim",art:"image/x-jg",asf:"video/x-ms-asf",asx:"video/x-ms-asf",au:"audio/basic",avi:"video/x-msvideo",avx:"video/x-rad-screenplay",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",body:"text/html",cdf:"application/x-cdf",cer:"application/pkix-cert",class:"application/java",cpio:"application/x-cpio",csh:"application/x-csh",css:"text/css",dib:"image/bmp",doc:"application/msword",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",eot:"application/vnd.ms-fontobject",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",gif:"image/gif",gtar:"application/x-gtar",gz:"application/x-gzip",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htc:"text/x-component",htm:"text/html",html:"text/html",ief:"image/ief",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",jsf:"text/plain",json:"application/json",jspf:"text/plain",kar:"audio/midi",latex:"application/x-latex",m3u:"audio/x-mpegurl",mac:"image/x-macpaint",man:"text/troff",mathml:"application/mathml+xml",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp1:"audio/mpeg",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpa:"audio/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/x-mpeg",mpg:"video/mpeg",mpv2:"video/mpeg2",ms:"application/x-wais-source",nc:"application/x-netcdf",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",ogx:"application/ogg",ogv:"video/ogg",oga:"audio/ogg",ogg:"audio/ogg",otf:"application/x-font-opentype",spx:"audio/ogg",flac:"audio/flac",anx:"application/annodex",axa:"audio/annodex",axv:"video/annodex",xspf:"application/xspf+xml",pbm:"image/x-portable-bitmap",pct:"image/pict",pdf:"application/pdf",pgm:"image/x-portable-graymap",pic:"image/pict",pict:"image/pict",pls:"audio/x-scpls",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"text/troff",rtf:"application/rtf",rtx:"text/richtext",sfnt:"application/font-sfnt",sh:"application/x-sh",shar:"application/x-shar",sit:"application/x-stuffit",snd:"audio/basic",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"text/troff",tsv:"text/tab-separated-values",ttf:"application/x-font-ttf",txt:"text/plain",ulw:"audio/basic",ustar:"application/x-ustar",vxml:"application/voicexml+xml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",vsd:"application/vnd.visio",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlsc",wmlscriptc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",woff:"application/font-woff",woff2:"application/font-woff2",wrl:"model/vrml",wspolicy:"application/wspolicy+xml",z:"application/x-compress",zip:"application/zip",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};function getTabIdFromLink(e){return e.split("#").slice(-1)[0]}function hasTabAnyChanges(e){return void 0!==changesInTabs[e]&&null!==changesInTabs[e]&&changesInTabs[e].newRows.size+changesInTabs[e].editedRows.size+changesInTabs[e].removedRows.size>0}function sendTabData(e){$.ajax({url:window.location.pathname,data:JSON.stringify(e),type:"PUT",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value},contentType:"application/json",success(e,a,t){window.location.reload()},error(e,a,t){console.log(a,t)}})}function FakeDataTransfer(e){this.dropEffect="all",this.effectAllowed="all",this.items=[],this.types=["Files"],this.getData=function(){return this.dt},this.dt=new DataTransfer;for(let a=0;a<e.length;a++)this.dt.items.add(e[a])}function sendOrRemoveFiles(e){$.ajax({url:window.location.pathname,data:e,type:"POST",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value},contentType:!1,processData:!1,success(e,a,t){window.location.reload()},error(e,a,t){console.log(a,t)}})}const tabs=document.querySelectorAll("li.tab-fit-btn");for(let i=0;i<tabs.length;i++)tabs[i].childNodes[0].addEventListener("shown.bs.tab",function(e){if(!0===hasTabAnyChanges(getTabIdFromLink(e.relatedTarget.href))&&1===e.relatedTarget.childNodes.length){let a=$(e.relatedTarget),t=a.text().trim();a.append($('<i class="fe fe-edit tab-not-saved"></i>')),bootbox.alert({title:'<i class="fa fa-exclamation-triangle" style="color: red;"></i>&emsp; Uwaga!',message:`W zakładce "${t}" są niezapisane zmiany. Odświeżenie strony lub zapisanie danych z innej zakładki spowoduje <b>utratę danych!<b>`,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl"})}});const servicesTable=$("#data-table1").DataTable({language:dataTableLanguageOpt,stateSave:!0,autoWidth:!1,columns:[{searchable:!0,width:"30%"},{searchable:!0,width:"60%"},{searchable:!1,orderable:!1,width:"10%",render:function(e,a,t){return`<div class="information-action-dropdown dataTables_empty" style="width: 100%; height: 100%;">
                            <button class="information-action-dropdown-btn dataTables_empty">...</button>
                            <div class="information-action-dropdown-content dataTables_empty">
                                <a href="#" onclick="editServiceRow(this)"><i class="fe fe-edit mr-2"></i>&ensp;Edytuj</a>
                                <a href="#" style="color: #6C757D;" onclick="removeServiceRow(this)" data-service-name="${e[0]}"><i class="fe fe-trash-2 mr-2"></i>&ensp;Usuń</a>
                            </div>
                        </div>`}},]}),servicesToRemove=new Set;function addService(){return bootbox.dialog({title:"Podaj dane nowej usługi.",message:`
            <label class="form-label" id="newServiceNameLabel">Nazwa<span class="asteriskField">*</span></label>
            <input type="text" id="newServiceName" class="bootbox-input bootbox-input-textarea form-control" required placeholder="Nazwa usługi" maxlength="128"/>
            <p></p>
            <label class="form-label">Opis usługi</label>
            <textarea id="newServiceDescription" class="bootbox-input bootbox-input-textarea form-control" placeholder="Opis usługi" rows="5" maxlength="2000"></textarea>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=$("#newServiceName");if(null==e.val()||""===e.val().replace(/^\s+|\s+$/gm,""))return e.attr("placeholder","Nazwa usługi nie może być pusta!"),e.addClass("is-invalid"),$("label#newServiceNameLabel").addClass("invalid-form-label-asterix"),e.on("input",function(){e.removeClass("is-invalid"),$("label#newServiceNameLabel").removeClass("invalid-form-label-asterix"),e.off("input")}),!1;{let a=$("#newServiceDescription");changesInTabs.tab2.newRows.add(servicesTable.data().length),servicesTable.row.add([e.val().trim(),a.val().trim(),[e.val().trim(),!0]]).draw(!1)}}}}}),!1}function editServiceRow(e){let a=$(e).closest("tr"),t=a.children(),l=$(t[0]).text(),o=$(t[1]).text();return bootbox.dialog({title:"Edytuj dane usługi.",message:`
            <label class="form-label" id="newServiceNameLabel">Nazwa<span class="asteriskField">*</span></label>
            <input type="text" id="newServiceName" class="bootbox-input bootbox-input-textarea form-control" required value="${l}" placeholder="${l}" maxlength="32"/>
            <p></p>
            <label class="form-label">Opis usługi</label>
            <textarea id="newServiceDescription" class="bootbox-input bootbox-input-textarea form-control" placeholder="${o}" rows="5" maxlength="2000">${o}</textarea>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=$("#newServiceName");if(null==e.val()||""===e.val().replace(/^\s+|\s+$/gm,""))return e.attr("placeholder","Nazwa usługi nie może być pusta!"),e.addClass("is-invalid"),$("label#newServiceNameLabel").addClass("invalid-form-label-asterix"),e.on("input",function(){e.removeClass("is-invalid"),$("label#newServiceNameLabel").removeClass("invalid-form-label-asterix"),e.off("input")}),!1;{let t=servicesTable.row(a).data();t[0]=e.val(),t[1]=$("#newServiceDescription").val(),!1===Array.isArray(t[2])?t[2]=[e.val(),!1]:!0!==t[2][1]&&(t[2].length>1?(t[2][0]=e.val(),t[2][1]=!1):t[2].push(!1));let l=a.data("company-service-id");null!=l&&""!==l&&(3===t[2].length?t[2][2]=Number(l):t[2].push(Number(l))),servicesTable.row(a).data(t),changesInTabs.tab2.editedRows.add(servicesTable.row(a).index())}}}}}),!1}function removeServiceRow(e){let a=$(e).closest("tr"),t=a.data("company-service-id");null!=t&&""!==t&&servicesToRemove.add(Number(t));let l=servicesTable.row(a).index();return a.addClass("selected"),!1===changesInTabs.tab2.newRows.has(l)&&changesInTabs.tab2.removedRows.add(l),changesInTabs.tab2.newRows.delete(l),changesInTabs.tab2.editedRows.delete(l),servicesTable.row(".selected").remove().draw(!1),!1}function serializeServices(){let e=servicesTable.data(),a={type:"services",new:[],edited:[],deleted:[...servicesToRemove]};for(let t=0;t<e.length;t++)!0===Array.isArray(e[t][2])&&e[t][2].length>1&&(!0===e[t][2][1]?a.new.push({name:e[t][0],description:e[t][1]}):a.edited.push({id:e[t][2][2],name:e[t][0],description:e[t][1]}));return a}function saveServices(){return!0===hasTabAnyChanges("tab2")&&(globalLoader.show(),sendTabData(serializeServices())),!1}function editCompanyDesc(){return bootbox.dialog({title:"Podaj opis firmy.",message:`
            <label class="form-label">Opis firmy</label>
            <textarea id="newCompanyDescription" class="bootbox-input bootbox-input-textarea form-control" placeholder="Opis firmy" rows="5" maxlength="2000">${$("div#companyDescText").text()}</textarea>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){globalLoader.show(),sendTabData({type:"description",description:$("#newCompanyDescription").val()})}}}}),!1}function editCompanyLogo(){return bootbox.dialog({title:"Podaj nowe logo firmy.",message:`
            <div class="form-row">
                <div class="form-group col-md-12 mb-0">
                    <div id="div_id_company_logo" class="mb-3">
                        <label for="id_company_logo" class="form-label"><b>Logo</b></label>
                        <div class=" mb-2">
                            <div>
                                <input type="file" name="company_logo" class="form-control" accept="image/*" id="id_company_logo">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",size:"large",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=document.getElementById("id_company_logo").files[0];if(e){globalLoader.show();let a=new FormData;a.append("type","logo"),a.append("new_logo",e),sendOrRemoveFiles(a)}}}}}),!1}const certificatesTable=$("#data-table2").DataTable({language:dataTableLanguageOpt,stateSave:!0,autoWidth:!1,columns:[{searchable:!0,width:"40%"},{searchable:!0,width:"20%"},{searchable:!1,orderable:!0,width:"20%"},{searchable:!1,orderable:!1,width:"10%",render:function(e,a,t){if(null===e||null===e[0]||void 0===e[0]||!(e[1]>-1))return`<a href="javascript:void(0)" class="cert-file-icon-empty">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_1720_10942)">
                                            <path d="M17 19.22H5V7H12V5H3V21H19V12H17V19.22Z" fill="grey"/>
                                            <path d="M19 2H17V5H14C14.01 5.01 14 7 14 7H17V9.99C17.01 10 19 9.99 19 9.99V7H22V5H19V2Z" fill="#8A92A6"/>
                                            <path d="M15 9H7V11H15V9Z" fill="#8A92A6"/>
                                            <path d="M7 12V14H15V12H12H7Z" fill="#8A92A6"/>
                                            <path d="M15 15H7V17H15V15Z" fill="#8A92A6"/>
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1720_10942">
                                                <rect width="24" height="24" fill="grey"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </a>`;{let l="",o="";return 3===e.length?(l=e[0],o=e[2]):(l=URL.createObjectURL(e[0]),o=e[0].name),`<a href="${l}" download="${o}" data-file-index="${e[1]}" class="cert-file-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_1720_10924)">
                                            <path d="M15 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V7L15 2ZM6 20V4H14V8H18V20H6ZM16 10V15C16 17.21 14.21 19 12 19C9.79 19 8 17.21 8 15V8.5C8 7.03 9.26 5.86 10.76 6.01C12.06 6.14 13 7.33 13 8.64V15H11V8.5C11 8.22 10.78 8 10.5 8C10.22 8 10 8.22 10 8.5V15C10 16.1 10.9 17 12 17C13.1 17 14 16.1 14 15V10H16Z" fill="#23c678"/>
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1720_10924">
                                                <rect width="24" height="24" fill="#23c678"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </a>`}}},{searchable:!1,orderable:!1,width:"10%",render:function(e,a,t){return`<div class="information-action-dropdown dataTables_empty" style="width: 100%; height: 100%;">
                                <button class="information-action-dropdown-btn dataTables_empty">...</button>
                                <div class="information-action-dropdown-content dataTables_empty">
                                    <a href="#" onclick="editCertRow(this)" data-cert-file-index="${e[1]}"><i class="fe fe-edit mr-2"></i>&ensp;Edytuj</a>
                                    <a href="#" style="color: #6C757D;" onclick="removeCertRow(this)"><i class="fe fe-trash-2 mr-2"></i>&ensp;Usuń</a>
                                </div>
                            </div>`}},]});let certificatesCounter=0;const certTypesDict={};let certTypesSelectTemplate='<select name="type" class="select form-select" required="" id="id_type"><option value="" selected="">---------</option>';const certFiles={};let datePicker,wasDateUpdate=!1;const certificatesToRemove=new Set;function addCertificate(){let e=bootbox.dialog({title:"Podaj dane nowego certyfikatu.",message:`
            <label class="form-label" id="newCertNameLabel">Nazwa<span class="asteriskField">*</span></label>
            <input type="text" id="newCertName" class="bootbox-input bootbox-input-textarea form-control" required placeholder="Nazwa certyfikatu" maxlength="128"/>
            <p></p>
            <label class="form-label" id="newCertTypeLabel">Typ certyfikatu<span class="asteriskField">*</span></label>
            ${certTypesSelectTemplate}
            <p></p>
            <label class="form-label" id="newCertDateLabel">Data wystawienia<span class="asteriskField">*</span></label>
            <label class="form-label">(Jeśli data nie zostanie wybrana, zostanie użyta dzisiejsza data)</label>
            <div class="input-group" id="datetimepicker1" data-td-target-input="nearest" data-td-target-toggle="nearest">
                <input type="text" class="form-control" name="date" id="id_date" data-td-target="#datetimepicker1" placeholder="Data wystawienia"/>
                <div class="input-group-append date-select-btn" data-td-target="#datetimepicker1" data-td-toggle="datetimepicker">
                    <div class="input-group-text" style="height: 100%"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
            <p></p>
            <label class="form-label">Plik</label>
            <div class=" mb-2">
                <div><input type="file" name="cert_file" class="form-control" accept="*" id="id_cert_file"></div>
            </div>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=$("input#newCertName"),a=$("select#id_type"),t=a.find(":selected").val(),l=null==e.val()||""===e.val().replace(/^\s+|\s+$/gm,""),o=""===t;if(l||o)return l&&(e.attr("placeholder","Nazwa certyfikatu nie może być pusta!"),e.addClass("is-invalid"),$("label#newCertNameLabel").addClass("invalid-form-label-asterix"),e.on("input",function(){e.removeClass("is-invalid"),$("label#newCertNameLabel").removeClass("invalid-form-label-asterix"),e.off("input")})),o&&(a.addClass("is-invalid"),$("label#newTypeNameLabel").addClass("invalid-form-label-asterix"),a.on("input",function(){a.removeClass("is-invalid"),$("label#newTypeNameLabel").removeClass("invalid-form-label-asterix"),a.off("input")})),!1;{let n=new Date(datePicker.viewDate).toLocaleDateString("pl-PL",{year:"numeric",month:"2-digit",day:"2-digit"}),s=document.getElementById("id_cert_file").files,r=null,d=-1;s.length>0&&(r=s[0],certFiles[certificatesCounter]=s[0],d=certificatesCounter,certificatesCounter++),changesInTabs.tab3.newRows.add(certificatesTable.data().length),certificatesTable.row.add([e.val().trim(),a.find(":selected").text(),n,[r,d],[e.val().trim(),d,!0]]).draw(!1)}}}}});return e.init(function(){let e=document.getElementById("datetimepicker1");datePicker=new tempusDominus.TempusDominus(e,{display:{components:{clock:!0,hours:!1,minutes:!1,seconds:!1,useTwentyfourHour:!1},buttons:{today:!0,close:!0,clear:!0},icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-arrow-up",down:"fa fa-arrow-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left",today:"fa fa-calendar-check-o",clear:"fa fa-trash",close:"fa fa-times"},viewMode:"calendar"}})}),!1}function editCertRow(e){let a=$(e).closest("tr"),t=a.children(),l=$(t[0]).text(),o=$(t[1]).text(),n=$(t[2]).text(),s=Number($(e).data("cert-file-index")),r=bootbox.dialog({title:"Edytuj dane certyfikatu.",message:`
            <label class="form-label" id="newCertNameLabel">Nazwa<span class="asteriskField">*</span></label>
            <input type="text" id="newCertName" class="bootbox-input bootbox-input-textarea form-control" required value="${l}" placeholder="${l}" maxlength="128"/>
            <p></p>
            <label class="form-label" id="newCertTypeLabel">Typ certyfikatu<span class="asteriskField">*</span></label>
            ${window.getCertTypeSelectedSelect(o)}
            <p></p>
            <label class="form-label" id="newCertDateLabel">Data wystawienia<span class="asteriskField">*</span></label>
            <div class="input-group" id="datetimepicker1" data-td-target-input="nearest" data-td-target-toggle="nearest">
                <input type="text" class="form-control" name="date" id="id_date" data-td-target="#datetimepicker1" value="${n}" placeholder="${n}"/>
                <div class="input-group-append date-select-btn" data-td-target="#datetimepicker1" data-td-toggle="datetimepicker">
                    <div class="input-group-text" style="height: 100%"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
            <p></p>
            <label class="form-label">Plik</label>
            <div class="row">
                <div class="mb-2 col-11 c-pr-0">
                    <div>
                        <input type="file" name="cert_file" class="form-control" accept="*" id="id_cert_file">
                    </div>
                </div>
                <span class="input-group-text btn-danger col-1 delete-file-btn"><i class="fe fe-trash"></i></span>
            </div>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){datePicker&&datePicker.hide()}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=$("input#newCertName"),l=$("select#id_type"),o=l.find(":selected").val(),n=null==e.val()||""===e.val().replace(/^\s+|\s+$/gm,""),r=""===o;if(n||r)return n&&(e.attr("placeholder","Nazwa certyfikatu nie może być pusta!"),e.addClass("is-invalid"),$("label#newCertNameLabel").addClass("invalid-form-label-asterix"),e.on("input",function(){e.removeClass("is-invalid"),$("label#newCertNameLabel").removeClass("invalid-form-label-asterix"),e.off("input")})),r&&(l.addClass("is-invalid"),$("label#newTypeNameLabel").addClass("invalid-form-label-asterix"),l.on("input",function(){l.removeClass("is-invalid"),$("label#newTypeNameLabel").removeClass("invalid-form-label-asterix"),l.off("input")})),!1;{let d=$("input#id_date").val();!0===wasDateUpdate&&(d=new Date(datePicker.viewDate).toLocaleDateString("pl-PL",{year:"numeric",month:"2-digit",day:"2-digit"})),wasDateUpdate=!1;let c=certificatesTable.row(a).data();c[0]=e.val().trim(),c[1]=l.find(":selected").text(),c[2]=d;let p=document.getElementById("id_cert_file").files;p.length>0?s>-1?(certFiles[s]=p[0],URL.revokeObjectURL($(t[3]).children()[0].href),c[3]=[p[0],s]):(certFiles[certificatesCounter]=p[0],c[3]=[p[0],certificatesCounter],certificatesCounter++):0===p.length?null!==c[3]&&"string"==typeof c[3][0]?c[3]=["---*|REMOVED FILE|*---",-1]:null===c[4][2]&&(c[3]=["---*|REMOVED FILE|*---",-1]):s>-1&&(delete certFiles[s],c[3]=null),c[4][2]=!1,certificatesTable.row(a).data(c),changesInTabs.tab3.editedRows.add(certificatesTable.row(a).index()),datePicker.hide()}}}}});return r.init(function(){if(s>-1){let e=$("input#id_cert_file");if(e.on("drop",function(a){a.originalEvent.dataTransfer&&"function"==typeof a.originalEvent.dataTransfer.getData&&(e[0].files=a.originalEvent.dataTransfer.getData().files)}),"string"!=typeof certFiles[s]){let a=new DragEvent("drop");Object.defineProperty(a,"dataTransfer",{value:new FakeDataTransfer([certFiles[s]])}),e[0].dispatchEvent(a)}else e.attr("placeholder",certFiles[s]),e.attr("value",certFiles[s])}let t=document.getElementById("datetimepicker1");(datePicker=new tempusDominus.TempusDominus(t,{display:{components:{clock:!0,hours:!1,minutes:!1,seconds:!1,useTwentyfourHour:!1},buttons:{today:!0,close:!0,clear:!0},icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-arrow-up",down:"fa fa-arrow-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left",today:"fa fa-calendar-check-o",clear:"fa fa-trash",close:"fa fa-times"},viewMode:"calendar"}})).subscribe(tempusDominus.Namespace.events.change,e=>{wasDateUpdate=!0}),$("span.delete-file-btn").click(function(){document.getElementById("id_cert_file").value=""})}),!1}function removeCertRow(e){let a=$(e).closest("tr"),t=certificatesTable.row(a).data()[4][1];null!=t&&t>-1&&certificatesToRemove.add(t);let l=certificatesTable.row(a).index();return a.addClass("selected"),!1===changesInTabs.tab3.newRows.has(l)&&changesInTabs.tab3.removedRows.add(l),changesInTabs.tab3.newRows.delete(l),changesInTabs.tab3.editedRows.delete(l),certificatesTable.row(".selected").remove().draw(!1),!1}function saveCertificates(){if(hasTabAnyChanges("tab3")){globalLoader.show();let e=certificatesTable.data(),a={type:"certificates",new:[],edited:[],"new-files":[],"edited-files":[]};for(let t=0;t<e.length;t++)!0===e[t][4][2]?(a.new.push({name:e[t][0],type:certTypesDict[e[t][1]],date:e[t][2]}),null!==e[t][3][0]&&e[t][3][1]>-1&&a["new-files"].push({id:`new-||-${t}-||-${e[t][0]}`,file:e[t][3][0]})):!1===e[t][4][2]&&(a.edited.push({id:Number(e[t][4][3]),name:e[t][0],type:certTypesDict[e[t][1]],date:e[t][2]}),null!==e[t][3][0]&&e[t][3][1]>-1?"string"!=typeof e[t][3][0]?a["edited-files"].push({id:`edited-||-${t}-||-${e[t][0]}`,file:e[t][3][0]}):"---*|REMOVED FILE|*---"===e[t][3][0]&&a["edited-files"].push({id:`removed-edited-||-${t}-||-${e[t][0]}`}):null!==e[t][3][0]&&"---*|REMOVED FILE|*---"===e[t][3][0]&&a["edited-files"].push({id:`removed-edited-||-${t}-||-${e[t][0]}`}));let l=new FormData;l.append("type","certificates"),l.append("new",JSON.stringify(a.new)),l.append("edited",JSON.stringify(a.edited)),l.append("deleted",[...certificatesToRemove]);for(let o=0;o<a["new-files"].length;o++)l.append(a["new-files"][o].id,a["new-files"][o].file);for(let n=0;n<a["edited-files"].length;n++)void 0!==a["edited-files"][n].file&&null!==a["edited-files"][n].file?l.append(a["edited-files"][n].id,a["edited-files"][n].file):l.append(a["edited-files"][n].id,!0);sendOrRemoveFiles(l)}return!1}const projectsTable=$("#data-table3").DataTable({language:dataTableLanguageOpt,stateSave:!0,autoWidth:!1,columns:[{searchable:!0,width:"25%"},{searchable:!0,width:"50%"},{searchable:!1,orderable:!1,width:"15%",render:function(e,a,t){return null!=e&&""!==e?`<a href="${e}" target="_blank">Strona projektu</a>`:"-"}},{searchable:!1,orderable:!1,width:"10%",render:function(e,a,t){return`<div class="information-action-dropdown dataTables_empty" style="width: 100%; height: 100%;">
                        <button class="information-action-dropdown-btn dataTables_empty">...</button>
                        <div class="information-action-dropdown-content dataTables_empty">
                            <a href="#" onclick="editProjectRow(this)"><i class="fe fe-edit mr-2"></i>&ensp;Edytuj</a>
                            <a href="#" style="color: #6C757D;" onclick="removeProjectRow(this)"><i class="fe fe-trash-2 mr-2"></i>&ensp;Usuń</a>
                        </div>
                    </div>`}},]}),projectsToRemove=new Set;function addProject(){return bootbox.dialog({title:"Podaj dane nowego projektu.",message:`
            <label class="form-label" id="newProjectNameLabel">Nazwa<span class="asteriskField">*</span></label>
            <input type="text" id="newProjectName" class="bootbox-input bootbox-input-textarea form-control" required placeholder="Nazwa projektu" maxlength="128"/>
            <p></p>
            <label class="form-label">Opis</label>
            <textarea id="newProjectDescription" class="bootbox-input bootbox-input-textarea form-control" placeholder="Opis projektu" rows="5" maxlength="2000"></textarea>
            <p></p>
            <label class="form-label">Strona projektu</label>
            <input type="url" id="newProjectUrl" class="bootbox-input bootbox-input-textarea form-control" placeholder="Strona projektu: https://example.com"/>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=$("input#newProjectName");if(null==e.val()||""===e.val().replace(/^\s+|\s+$/gm,""))return e.attr("placeholder","Nazwa projektu nie może być pusta!"),e.addClass("is-invalid"),$("label#newProjectNameLabel").addClass("invalid-form-label-asterix"),e.on("input",function(){e.removeClass("is-invalid"),$("label#newProjectNameLabel").removeClass("invalid-form-label-asterix"),e.off("input")}),!1;{let a=$("#newProjectUrl").val().trim();""!==a&&!1===a.startsWith("https://")&&!1===a.startsWith("http://")&&(a="https://"+a),changesInTabs.tab4.newRows.add(projectsTable.data().length),projectsTable.row.add([e.val().trim(),$("#newProjectDescription").val().trim(),a,[!0],]).draw(!1)}}}}}),!1}function editProjectRow(e){let a=$(e).closest("tr"),t=a.children(),l=$(t[0]).text(),o=$(t[1]).text(),n=$(t[2].childNodes[0]),s="";return!0===n.is("a")&&(s=n[0].href),bootbox.dialog({title:"Podaj dane projektu.",message:`
            <label class="form-label" id="newProjectNameLabel">Nazwa<span class="asteriskField">*</span></label>
            <input type="text" id="newProjectName" class="bootbox-input bootbox-input-textarea form-control" required value="${l}" placeholder="Nazwa projektu" maxlength="128"/>
            <p></p>
            <label class="form-label">Opis</label>
            <textarea id="newProjectDescription" class="bootbox-input bootbox-input-textarea form-control" placeholder="Opis projektu" rows="5" maxlength="2000">${o}</textarea>
            <p></p>
            <label class="form-label">Strona projektu</label>
            <input type="url" id="newProjectUrl" class="bootbox-input bootbox-input-textarea form-control" value="${s}" placeholder="Strona projektu: https://example.com"/>
        `,onEscape:!0,backdrop:!0,centerVertical:!0,locale:"pl",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger",callback:function(){}},ok:{label:'<i class="fa fa-check"></i> Zatwierdź',className:"btn-primary",callback:function(){let e=$("input#newProjectName");if(null==e.val()||""===e.val().replace(/^\s+|\s+$/gm,""))return e.attr("placeholder","Nazwa projektu nie może być pusta!"),e.addClass("is-invalid"),$("label#newProjectNameLabel").addClass("invalid-form-label-asterix"),e.on("input",function(){e.removeClass("is-invalid"),$("label#newProjectNameLabel").removeClass("invalid-form-label-asterix"),e.off("input")}),!1;{let l=$("#newProjectUrl").val().trim();""!==l?(!1===l.startsWith("https://")&&!1===l.startsWith("http://")&&(l="https://"+l),$(t[2]).empty(),$(t[2]).append($(`<a href="${l}" target="_blank">Strona projektu</a>`))):$(t[2]).text("-");let o=projectsTable.row(a).data();o[0]=e.val().trim(),o[1]=$("#newProjectDescription").val().trim(),o[2]=l,!1===Array.isArray(o[3])?o[3]=[!1]:!0!==o[3][0]&&(o[3].length>0?o[3][0]=!1:o[3].push(!1));let n=a.data("company-project-id");null!=n&&""!==n&&(2===o[3].length?o[3][1]=Number(n):o[3].push(Number(n))),projectsTable.row(a).data(o),changesInTabs.tab4.editedRows.add(projectsTable.row(a).index())}}}}}),!1}function removeProjectRow(e){let a=$(e).closest("tr"),t=a.data("company-project-id");null!=t&&""!==t&&projectsToRemove.add(Number(t));let l=projectsTable.row(a).index();return a.addClass("selected"),!1===changesInTabs.tab4.newRows.has(l)&&changesInTabs.tab4.removedRows.add(l),changesInTabs.tab4.newRows.delete(l),changesInTabs.tab4.editedRows.delete(l),projectsTable.row(".selected").remove().draw(!1),!1}function serializeProjects(){let e=projectsTable.data(),a={type:"projects",new:[],edited:[],deleted:[...projectsToRemove]};for(let t=0;t<e.length;t++)!0===Array.isArray(e[t][3])&&e[t][3].length>0&&(!0===e[t][3][0]?a.new.push({name:e[t][0],description:e[t][1],www:e[t][2]}):a.edited.push({id:e[t][3][1],name:e[t][0],description:e[t][1],www:e[t][2]}));return a}function saveProjects(){return!0===hasTabAnyChanges("tab4")&&(globalLoader.show(),sendTabData(serializeProjects())),!1}const photosUploader=$("#id_photos"),uploadedPhotos={};function sendFakePhotoDropEvent(){let e=new DragEvent("drop");Object.defineProperty(e,"dataTransfer",{value:new FakeDataTransfer(Object.values(uploadedPhotos))}),photosUploader[0].dispatchEvent(e)}photosUploader.FancyFileUpload({accept:["image/apng","image/avif","image/gif","image/jpeg","image/jpg","image/png","image/svg+xml","image/webp","image/bmp"],edit:!1,allowUpload:!1,originalInputId:"#id_photos",added:function(e,a){this.find(".ff_fileupload_actions button.ff_fileupload_start_upload").hide();for(let t=0;t<a.files.length;t++){uploadedPhotos[a.files[t].name]=a.files[t];let l=window.URL.createObjectURL(a.files[t]);window.URL.revokeObjectURL(l)}sendFakePhotoDropEvent()},fileRemoveOption:function(e){void 0!==uploadedPhotos[e]&&(delete uploadedPhotos[e],sendFakePhotoDropEvent())},langmap:{"Starting upload...":"Rozpoczynanie przesyłania...","Cancel upload and remove from list":"Anuluj przesłanie i usuń z listy",Preview:"Podgląd","No preview available":"Podgląd jest niedostępny","Invalid file extension.":"Błędne rozszerzenie pliku.","File is too large.  Maximum file size is {0}.":"Plik jest zbyt duży. Maksymalny rozmiar pliku to {0}","Start uploading":"Rozpocznij przesyłanie","Remove from list":"Usuń plik z listy","{0} of {1} | {2}%":"{0} z {1} | {2}%","{0} | Network error, retrying in a moment...":"{0} | Bląd połączenia, za chwilę rozpocznie się ponowna pr\xf3ba...","The upload was cancelled":"Przesyłanie zostało anulowane","The upload failed.  {0} ({1})":"Błąd przesyłania.  {0} ({1})","The upload failed.":"Błąd przesyłania.","Upload completed":"Zakończono przesyłanie","Browse, drag-and-drop, or paste files to upload":"Przeglądaj, upuść, lub wklej pliki, kt\xf3re chcesz przesłać","Accepted extensions: ":"Dopuszczalne rozszerzenia: "}}),photosUploader.on("drop",function(e){e.originalEvent.dataTransfer&&"function"==typeof e.originalEvent.dataTransfer.getData&&(photosUploader[0].files=e.originalEvent.dataTransfer.getData().files)});const photos=[];document.querySelectorAll("div#galleryPhotoElement").forEach(function(e){photos.push({src:$(e).data("src"),thumb:$(e).data("src"),subHtml:$(e).data("sub-html")})}),$(".pagination").rpmPagination({domElement:".gallery-page-container",limit:1,total:document.querySelectorAll("div.gallery-page-container").length,forceTotalPages:!0}),lightGallery(document.getElementById("lightgallery"),{dynamic:!0,dynamicEl:photos,pager:!0,zoom:!0,showZoomInOutIcons:!0});const gallery=window.lgData["lg"+(window.lgData.uid-1)];function addPhotos(){let e=`<div class="form-row">
                <div class="form-group col-md-12 mb-0">
                    <div id="div_id_files" class="mb-3">
                        <label for="id_files" class="form-label">Dodaj nowe zdjęcia</label>
                        <input type="file" name="files" class="form-control" accept="image/*" id="id_files" multiple>
                    </div>
                </div>
            </div>`;bootbox.confirm({title:`<span style="font-family: Roboto, sans-serif !important;"><i class="fe fe-file-plus"></i>&emsp;Dodaj zdjęcia do firmy</span>`,message:e,onEscape:!0,backdrop:!0,centerVertical:!0,size:"large",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger"},confirm:{label:'<i class="fa fa-check"></i> Potwierdź',className:"btn-primary"}},callback:function(e){if(!0===e){$("#global-loader").show();let a=$("#id_files")[0].files,t=new FormData;t.append("type","photos");for(let l=0;l<a.length;l++)t.append("file_"+l,a[l]);sendOrRemoveFiles(t)}},onShow:function(e){let a=$("#id_files"),t={};function l(){let e=new DragEvent("drop");Object.defineProperty(e,"dataTransfer",{value:new FakeDataTransfer(Object.values(t))}),a[0].dispatchEvent(e)}a.FancyFileUpload({accept:["image/apng","image/avif","image/gif","image/jpeg","image/jpg","image/png","image/svg+xml","image/webp","image/bmp"],edit:!1,allowUpload:!1,originalInputId:"#id_files",added:function(e,a){this.find(".ff_fileupload_actions button.ff_fileupload_start_upload").hide();for(let o=0;o<a.files.length;o++)t[a.files[o].name]=a.files[o];l()},fileRemoveOption:function(e){void 0!==t[e]&&(delete t[e],l())},langmap:{"Starting upload...":"Rozpoczynanie przesyłania...","Cancel upload and remove from list":"Anuluj przesłanie i usuń z listy",Preview:"Podgląd","No preview available":"Podgląd jest niedostępny","Invalid file extension.":"Blędne rozszerzenie pliku.","File is too large.  Maximum file size is {0}.":"Plik jest zbyt duży. Maksymalny rozmiar pliku to {0}","Start uploading":"Rozpocznij przesyłanie","Remove from list":"Usuń plik z listy","{0} of {1} | {2}%":"{0} z {1} | {2}%","{0} | Network error, retrying in a moment...":"{0} | Bląd połączenia, za chwilę rozpocznie się ponowna pr\xf3ba...","The upload was cancelled":"Przesyłanie zostało anulowane","The upload failed.  {0} ({1})":"Błąd przesyłania.  {0} ({1})","The upload failed.":"Błąd przesyłania.","Upload completed":"Zakończono przesyłanie","Browse, drag-and-drop, or paste files to upload":"Przeglądaj, upuść, lub wklej pliki, kt\xf3re chcesz przesłać"}}),a.on("drop",function(e){e.originalEvent.dataTransfer&&"function"==typeof e.originalEvent.dataTransfer.getData&&(a[0].files=e.originalEvent.dataTransfer.getData().files)})}})}function removePhotos(){let e=[];if(document.querySelectorAll("input[name=photo-delete]:checked").forEach(function(a){e.push(a.value)}),e.length>0){globalLoader.show();let a=new FormData;a.append("type","delete_photos"),a.append("ids",e),sendOrRemoveFiles(a)}return!1}function addFiles(){let e=`<div class="form-row">
                        <div class="form-group col-md-12 mb-0">
                            <div id="div_id_files" class="mb-3">
                                <label for="id_files" class="form-label">Dodaj nowe pliki</label>
                                <input type="file" name="files" class="form-control" accept="*" id="id_files" multiple>
                            </div>
                        </div>
                    </div>`;bootbox.confirm({title:'<span style="font-family: Roboto, sans-serif !important;"><i class="fe fe-file-plus"></i>&emsp;Dodaj pliki do firmy</span>',message:e,onEscape:!0,backdrop:!0,centerVertical:!0,size:"large",buttons:{cancel:{label:'<i class="fa fa-times"></i> Anuluj',className:"btn-danger"},confirm:{label:'<i class="fa fa-check"></i> Potwierdź',className:"btn-primary"}},callback:function(e){if(!0===e){$("#global-loader").show();let a=$("#id_files")[0].files,t=new FormData;t.append("type","files");for(let l=0;l<a.length;l++)t.append("file_"+l,a[l]);sendOrRemoveFiles(t)}},onShow:function(e){let a=$("#id_files"),t={};function l(){let e=new DragEvent("drop");Object.defineProperty(e,"dataTransfer",{value:new FakeDataTransfer(Object.values(t))}),a[0].dispatchEvent(e)}a.FancyFileUpload({accept:["*"],edit:!1,allowUpload:!1,originalInputId:"#id_files",added:function(e,a){this.find(".ff_fileupload_actions button.ff_fileupload_start_upload").hide();for(let o=0;o<a.files.length;o++)t[a.files[o].name]=a.files[o];l()},fileRemoveOption:function(e){void 0!==t[e]&&(delete t[e],l())},langmap:{"Starting upload...":"Rozpoczynanie przesyłania...","Cancel upload and remove from list":"Anuluj przesłanie i usuń z listy",Preview:"Podgląd","No preview available":"Podgląd jest niedostępny","Invalid file extension.":"Blędne rozszerzenie pliku.","File is too large.  Maximum file size is {0}.":"Plik jest zbyt duży. Maksymalny rozmiar pliku to {0}","Start uploading":"Rozpocznij przesyłanie","Remove from list":"Usuń plik z listy","{0} of {1} | {2}%":"{0} z {1} | {2}%","{0} | Network error, retrying in a moment...":"{0} | Bląd połączenia, za chwilę rozpocznie się ponowna pr\xf3ba...","The upload was cancelled":"Przesyłanie zostało anulowane","The upload failed.  {0} ({1})":"Błąd przesyłania.  {0} ({1})","The upload failed.":"Błąd przesyłania.","Upload completed":"Zakończono przesyłanie","Browse, drag-and-drop, or paste files to upload":"Przeglądaj, upuść, lub wklej pliki, kt\xf3re chcesz przesłać"}}),a.on("drop",function(e){e.originalEvent.dataTransfer&&"function"==typeof e.originalEvent.dataTransfer.getData&&(a[0].files=e.originalEvent.dataTransfer.getData().files)})}})}function removeFiles(){let e=[];if(document.querySelectorAll("input[name=file-delete]:checked").forEach(function(a){e.push(a.value)}),e.length>0){globalLoader.show();let a=new FormData;a.append("type","delete_files"),a.append("ids",e),sendOrRemoveFiles(a)}return!1}document.querySelectorAll("div#galleryPhotoElement > img").forEach(function(e){$(e).click(function(){gallery.build(Number($(this).data("gallery-idx")))})});